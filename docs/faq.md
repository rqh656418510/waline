# FAQ

Waline 诞生之初就已经作了很明确的定位：

> 一款`带后端`的`极简风`评论系统。

而后发布的所有版本都是围绕这个定位上来做的修改。

## 和 Valine 是什么关系？

```
Waline = With backend Valine
```

评论列表前端使用 React 参考着 Valine 的已开源版本进行了重写，样式和结构还有内部的一些工具方法都来自 Valine。

## 是否需要再在 LeanCloud 上部署 Valine-Admin？

不需要。Waline 是数据存储，服务端接口以及客户端三位一体的部署，其中服务端接口就已经相当于之前 Valine 的 LeanCloud 云引擎。服务端这块已经包含了之前云引擎提供的评论管理和邮件通知等相关的功能，不依赖额外的 LeanCloud 云引擎，也不会受到 LeanCloud 云引擎的休眠策略的限制。

## 如何升级？

Waline 主要由前端和服务端两部分组成。其中前端指的是网页中引入的 JS 脚本用来插入评论列表和评论框。大部分场景下该模块引用的是线上 CDN 最新版的地址，在发版之后会自动更新到最新，不需要使用者手动更新。不过有以下情况的需要手动更新：

1. CDN 地址中强制指定了版本号，这时候需要手动修改版本号达到最新。
2. 使用了 NPM 引入最终将模块打包到了代码中，这时候需要修改依赖中的版本号保证依赖在安装的时候能获取到最新版本。

除了前端之外，还有服务端的更新也会比较频繁。服务端指的是在前端脚本中配置的 `serverURL` 对应的服务，它的更新视不同的部署环境会略微有点区别。

- 使用 Vercel 部署的，进入到对应的 GitHub 仓库中，修改 package.json 文件中的 `@waline/vercel` 对应的版本号到最新即可。
  ![](../assets/doc/vercel-update.png)

- 使用 CloudBase 部署的，进入到代码编辑界面中，点击<kbd>保存并重新安装依赖</kbd>即可。如果还不行，则进入<kbd>我的应用</kbd> 选择 <kbd>部署</kbd> 进行重新部署。需要注意的是重新部署会清空之前的文件，如果之前文件中有配置的话需要先备份一下。
  ![](../assets/doc/cloudbase-update.jpg)

- 使用 Docker 部署的，直接 `docker pull lizheming/waline` 重新拉去下最新的镜像运行即可。

## 发布评论很慢怎么办？

发布评论的时候因为一些特殊原因，垃圾邮件检测、评论通知都是串联操作。其中垃圾邮件检测使用的是 Akismet 提供的服务，这块由于调用国外服务可能会造成访问过慢，我们可以通过 `AKISMET_KEY=false` 环境变量关闭垃圾评论检测功能来确认此事。除了垃圾评论检测服务之外，评论通知中的邮件通知也有可能造成超时，这块建议可以先关闭评论通知再测一下是否是因为该功能导致的过慢。

## 最后

以后`Waline`可能会有所变化，但不管如何变，不会改变`有后端`这个初衷。
